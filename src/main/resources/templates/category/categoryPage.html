<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>카테고리 - Together</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/categoryPage.css}">
</head>
<body>

<div th:replace="~{/layout/header :: header}"></div>

<main class="container px-4 px-lg-5">

  <div class="row g-5 mt-3">

    <div class="col-12">
      <div class="p-4 rounded-3 section-box meeting-section">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h3 class="mb-0">모임</h3>
        </div>

        <div th:if="${#lists.isEmpty(meetings)}" class="alert alert-info text-center">
          <i class="fas fa-info-circle me-2"></i> 공개된 모임이 없습니다.
        </div>

        <div class="list-group list-group-flush" th:unless="${#lists.isEmpty(meetings)}">
          <a th:each="meeting : ${meetings}"
             th:href="@{/cafe/{cafeId}/meeting/read(id=${meeting.id}, cafeId=${meeting.cafe.id})}"
             class="list-group-item list-group-item-action meeting-list-item">
            <div class="d-flex w-100 justify-content-between">
              <strong class="mb-1" th:text="${meeting.title}">모임 제목</strong>
              <small class="text-primary" th:text="${#temporals.format(meeting.meetingDate, 'MM/dd HH:mm')}">날짜</small>
            </div>
            <p class="mb-1 text-truncate" th:text="${meeting.content}">모임 내용</p>
          </a>
        </div>
        <nav th:if="${meetingsPage.total > 0}" aria-label="Meeting Pagination" class="mt-4">
          <ul class="pagination justify-content-center">
            <li class="page-item" th:each="pageNum : ${#numbers.sequence(meetingsPage.start, meetingsPage.end)}"
                th:classappend="${pageNum == meetingsPage.pageRequestDTO.page} ? 'active'">
              <a class="page-link" th:href="@{/categories(category=${category}, m_page=${pageNum}, m_size=${meetingsPage.size}, c_page=${cafesPage.pageRequestDTO.page}, c_size=${cafesPage.pageRequestDTO.size}, t_page=${tradesPage.pageRequestDTO.page}, t_size=${tradesPage.pageRequestDTO.size}, type=${meetingsPage.pageRequestDTO.type}, keyword=${meetingsPage.pageRequestDTO.keyword}, sort=${meetingsPage.pageRequestDTO.sort})}"
                 th:text="${pageNum}"></a>
            </li>
          </ul>
        </nav>
      </div>
    </div>

    <div class="col-12">
      <div class="p-4 rounded-3 section-box cafe-section">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h3 class="mb-0">카페</h3>
        </div>

        <div th:if="${#lists.isEmpty(cafes)}" class="alert alert-warning text-center">
          <i class="fas fa-exclamation-triangle me-2"></i> 해당 카테고리 카페가 없습니다.
        </div>

        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4" th:unless="${#lists.isEmpty(cafes)}">
          <div class="col" th:each="cafe : ${cafes}">
            <div class="card h-100 cafe-card border-success">
              <img th:src="${cafe.cafeThumbnail ?: '/images/default-cafe.png'}" class="card-img-top" th:alt="${cafe.name}">
              <div class="card-body d-flex flex-column">
                <h5 class="card-title text-success" th:text="${cafe.name}">카페 이름</h5>
                <p class="card-text text-truncate" th:text="${cafe.description}">카페 설명</p>
                <p class="text-muted small mt-auto mb-2"><i class="fas fa-users me-1"></i> 멤버 <span th:text="${cafe.memberCount}">0</span>명</p>
                <a th:href="@{/cafe/{id}(id=${cafe.id})}" class="btn btn-sm btn-success mt-1">카페 보기</a>
              </div>
            </div>
          </div>
        </div>
        <nav th:if="${cafesPage.total > 0}" aria-label="Cafe Pagination" class="mt-4">
          <ul class="pagination justify-content-center">
            <li class="page-item" th:each="pageNum : ${#numbers.sequence(cafesPage.start, cafesPage.end)}"
                th:classappend="${pageNum == cafesPage.pageRequestDTO.page} ? 'active'">
              <a class="page-link" th:href="@{/categories(category=${category}, m_page=${meetingsPage.pageRequestDTO.page}, m_size=${meetingsPage.pageRequestDTO.size}, c_page=${pageNum}, c_size=${cafesPage.size}, t_page=${tradesPage.pageRequestDTO.page}, t_size=${tradesPage.pageRequestDTO.size}, type=${cafesPage.pageRequestDTO.type}, keyword=${cafesPage.pageRequestDTO.keyword}, sort=${cafesPage.pageRequestDTO.sort})}"
                 th:text="${pageNum}"></a>
            </li>
          </ul>
        </nav>
      </div>
    </div>

    <div class="col-12">
      <div class="p-4 rounded-3 section-box trade-section">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h3 class="mb-0">중고거래</h3>
        </div>

        <div th:if="${#lists.isEmpty(trades)}" class="alert alert-secondary text-center">
          <i class="fas fa-comment-dollar me-2"></i> 해당 카테고리 거래글이 없습니다.
        </div>

        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4" th:unless="${#lists.isEmpty(trades)}">
          <div class="col" th:each="trade : ${trades}">
            <div class="card h-100 trade-card border-info">
              <img th:src="${trade.thumbnail ?: '/images/default-trade.png'}" class="card-img-top" th:alt="${trade.title}">
              <div class="card-body d-flex flex-column">
                <h5 class="card-title text-info" th:text="${trade.title}">거래 제목</h5>
                <p class="text fw-bold mb-2">
                  <span th:text="${#numbers.formatDecimal(trade.price, 0, 'COMMA', 0, 'POINT')}">0</span>원
                </p>
                <p class="text-muted small mt-auto mb-2"><i class="fas fa-user me-1"></i> 판매자: <span th:text="${trade.sellerNickname}">닉네임</span></p>
                <a th:href="@{/trade/read/{id}(id=${trade.id})}" class="btn btn-sm btn-info mt-1">자세히 보기</a>
              </div>
            </div>
          </div>
        </div>
        <nav th:if="${tradesPage.total > 0}" aria-label="Trade Pagination" class="mt-4">
          <ul class="pagination justify-content-center">
            <li class="page-item" th:each="pageNum : ${#numbers.sequence(tradesPage.start, tradesPage.end)}"
                th:classappend="${pageNum == tradesPage.pageRequestDTO.page} ? 'active'">
              <a class="page-link" th:href="@{/categories(category=${category}, m_page=${meetingsPage.pageRequestDTO.page}, m_size=${meetingsPage.pageRequestDTO.size}, c_page=${cafesPage.pageRequestDTO.page}, c_size=${cafesPage.pageRequestDTO.size}, t_page=${pageNum}, t_size=${tradesPage.size}, type=${tradesPage.pageRequestDTO.type}, keyword=${tradesPage.pageRequestDTO.keyword}, sort=${tradesPage.pageRequestDTO.sort})}"
                 th:text="${pageNum}"></a>
            </li>
          </ul>
        </nav>
      </div>
    </div>

  </div> </main>

<div th:replace="~{/layout/footer :: footer}"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>