<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì ë“±ë¡ - Together</title>
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" th:href="@{/assets/favicon.ico}" />
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .register-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            margin: 0 auto;
        }

        .register-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .register-header h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .register-header p {
            color: #666;
            font-size: 14px;
        }

        .form-section {
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            background: #fafafa;
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-label {
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        .required {
            color: #dc3545;
        }

        .form-control, .form-select {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 12px;
            transition: all 0.3s;
        }

        .form-control:focus, .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }

        .form-control.is-invalid, .form-select.is-invalid {
            border-color: #dc3545;
        }

        .form-control.is-valid, .form-select.is-valid {
            border-color: #28a745;
        }

        .form-check-input:checked {
            background-color: #667eea;
            border-color: #667eea;
        }
        .btn-group-custom {
            display: flex !important;
            gap: 15px;
            margin: 50px 0 !important;
            padding: 20px 0 !important;
            border-top: 2px solid #eee !important;
            position: relative !important;
            z-index: 9999 !important;
            width: 100% !important;
        }

        .btn-submit, .btn-cancel {
            flex: 1 !important;
            padding: 15px !important;
            font-size: 16px !important;
            font-weight: bold !important;
            border-radius: 8px !important;
            min-height: 50px !important;
        }


        .btn-submit {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 15px 30px;
            font-weight: bold;
            border-radius: 8px;
            transition: transform 0.2s;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            color: white;
        }

        .btn-cancel {
            background: #6c757d;
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
        }

        .btn-cancel:hover {
            background: #5a6268;
            color: white;
        }

        .invalid-feedback {
            display: block;
            font-size: 0.875em;
            margin-top: 0.25rem;
        }

        .valid-feedback {
            display: block;
            font-size: 0.875em;
            margin-top: 0.25rem;
            color: #28a745;
        }

        .password-strength {
            font-size: 12px;
            margin-top: 5px;
        }

        .strength-weak { color: #dc3545; }
        .strength-medium { color: #ffc107; }
        .strength-strong { color: #28a745; }

        .form-text {
            font-size: 0.875em;
            color: #6c757d;
        }

        .role-description {
            font-size: 0.875em;
            color: #6c757d;
            margin-top: 0.25rem;
        }
    </style>
</head>


<body>
<div class="register-container">
    <div class="register-header">
        <h1>â• ìƒˆ ê´€ë¦¬ì ë“±ë¡</h1>
        <p>Together ì‹œìŠ¤í…œì— ìƒˆ ê´€ë¦¬ìë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤</p>
    </div>

    <!-- ì„±ê³µ/ì—ëŸ¬ ë©”ì‹œì§€ -->
    <div th:if="${message}" class="alert alert-success alert-dismissible fade show">
        <span th:text="${message}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show">
        <span th:text="${error}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <!-- Thymeleaf í¼ with ê°ì²´ ë°”ì¸ë”© -->
    <form th:action="@{/admin/manager/register}"
          th:object="${managerDTO}"
          method="post"
          novalidate>

        <!-- ê¸°ë³¸ ì •ë³´ ì„¹ì…˜ -->
        <div class="form-section">
            <div class="section-title">
                ğŸ‘¤ ê¸°ë³¸ ì •ë³´
            </div>

            <div class="mb-3">
                <label for="managerName" class="form-label">
                    ê´€ë¦¬ì ì´ë¦„ <span class="required">*</span>
                </label>
                <input type="text"
                       class="form-control"
                       id="managerName"
                       th:field="*{managerName}"
                       th:classappend="${#fields.hasErrors('managerName')} ? 'is-invalid' : ''"
                       placeholder="ì˜ˆ: ê¹€ì² ìˆ˜">
                <div th:if="${#fields.hasErrors('managerName')}"
                     class="invalid-feedback"
                     th:errors="*{managerName}">
                    ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.
                </div>
                <div th:unless="${#fields.hasErrors('managerName')}"
                     th:if="*{managerName != null and !managerName.isEmpty()}"
                     class="valid-feedback">
                    âœ“ ì˜¬ë°”ë¥¸ ì´ë¦„ì…ë‹ˆë‹¤.
                </div>
            </div>

            <div class="mb-3">
                <label for="email" class="form-label">
                    ì´ë©”ì¼ <span class="required">*</span>
                </label>
                <input type="email"
                       class="form-control"
                       id="email"
                       th:field="*{email}"
                       th:classappend="${#fields.hasErrors('email')} ? 'is-invalid' : ''"
                       placeholder="admin@example.com"
                       onchange="checkEmailAvailability()">
                <div th:if="${#fields.hasErrors('email')}"
                     class="invalid-feedback"
                     th:errors="*{email}">
                    ì˜¬ë°”ë¥¸ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.
                </div>
                <div id="emailAvailability" class="form-text"></div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="password" class="form-label">
                        ë¹„ë°€ë²ˆí˜¸ <span class="required">*</span>
                    </label>
                    <input type="password"
                           class="form-control"
                           id="password"
                           th:field="*{password}"
                           th:classappend="${#fields.hasErrors('password')} ? 'is-invalid' : ''"
                           placeholder="8ì ì´ìƒ ì…ë ¥"
                           onkeyup="checkPasswordStrength()">
                    <div id="passwordStrength" class="password-strength"></div>
                    <div th:if="${#fields.hasErrors('password')}"
                         class="invalid-feedback"
                         th:errors="*{password}">
                        ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.
                    </div>
                    <div class="form-text">ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•˜ì—¬ 8ì ì´ìƒ</div>
                </div>

                <div class="col-md-6 mb-3">
                    <label for="confirmPassword" class="form-label">
                        ë¹„ë°€ë²ˆí˜¸ í™•ì¸ <span class="required">*</span>
                    </label>
                    <input type="password"
                           class="form-control"
                           id="confirmPassword"
                           name="confirmPassword"
                           placeholder="ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥"
                           onkeyup="checkPasswordMatch()">
                    <div id="passwordMatch" class="password-strength"></div>
                </div>
            </div>
        </div>

        <!-- ê¶Œí•œ ì„¤ì • ì„¹ì…˜ -->
        <div class="form-section">
            <div class="section-title">
                ğŸ” ê¶Œí•œ ì„¤ì •
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">
                        ê´€ë¦¬ì ê¶Œí•œ <span class="required">*</span>
                    </label>
                    <div class="mt-2">
                        <div class="form-check mb-3">
                            <input class="form-check-input"
                                   type="radio"
                                   id="roleSuperAdmin"
                                   th:field="*{role}"
                                   value="SUPER_ADMIN"
                                   onchange="updateRoleDescription()">
                            <label class="form-check-label" for="roleSuperAdmin">
                                <strong>ìµœê³ ê´€ë¦¬ì</strong>
                                <div class="role-description">ëª¨ë“  ì‹œìŠ¤í…œ ê¶Œí•œ ë³´ìœ </div>
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input"
                                   type="radio"
                                   id="roleAdmin"
                                   th:field="*{role}"
                                   value="ADMIN"
                                   onchange="updateRoleDescription()">
                            <label class="form-check-label" for="roleAdmin">
                                <strong>ì¼ë°˜ê´€ë¦¬ì</strong>
                                <div class="role-description">ì œí•œëœ ê´€ë¦¬ ê¶Œí•œ</div>
                            </label>
                        </div>
                    </div>
                    <div th:if="${#fields.hasErrors('role')}"
                         class="invalid-feedback d-block"
                         th:errors="*{role}">
                        ê¶Œí•œì„ ì„ íƒí•´ì£¼ì„¸ìš”.
                    </div>
                </div>

                <div class="col-md-6 mb-3">
                    <label for="status" class="form-label">
                        ì´ˆê¸° ìƒíƒœ <span class="required">*</span>
                    </label>
                    <select class="form-select"
                            id="status"
                            th:field="*{status}"
                            th:classappend="${#fields.hasErrors('status')} ? 'is-invalid' : ''">
                        <option value="">ìƒíƒœë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="ACTIVE">í™œì„± - ì¦‰ì‹œ ë¡œê·¸ì¸ ê°€ëŠ¥</option>
                        <option value="INACTIVE">ë¹„í™œì„± - ìŠ¹ì¸ í›„ í™œì„±í™”</option>
                    </select>
                    <div th:if="${#fields.hasErrors('status')}"
                         class="invalid-feedback"
                         th:errors="*{status}">
                        ìƒíƒœë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.
                    </div>
                </div>
            </div>

            <!-- ì„ì‹œ ë²„íŠ¼ í…ŒìŠ¤íŠ¸ -->
            <div style="background: red; padding: 20px; margin: 20px 0; text-align: center;">
                <button type="button" onclick="goBack()" style="background: #6c757d; color: white; padding: 15px 30px; margin-right: 10px; border: none; border-radius: 5px; font-size: 16px;">
                    ì·¨ì†Œ
                </button>
                <button type="submit" style="background: #667eea; color: white; padding: 15px 30px; border: none; border-radius: 5px; font-size: 16px;">
                    ë“±ë¡í•˜ê¸°
                </button>
            </div>

            <!-- ê¶Œí•œ ì„¤ëª… ë°•ìŠ¤ -->
            <div id="rolePermissions" class="alert alert-info" style="display: none;">
                <h6>ê¶Œí•œ ìƒì„¸:</h6>
                <ul id="permissionList" class="mb-0"></ul>
            </div>
        </div>

        <!-- CSRF í† í° -->
        <input type="hidden" th:if="${_csrf}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

        <!-- ë²„íŠ¼ ê·¸ë£¹ -->
        <div class="btn-group-custom" style="display: flex !important; gap: 15px; margin: 50px 0; padding: 20px 0; border-top: 2px solid #eee;">
            <button type="button" class="btn btn-cancel" onclick="goBack()" style="flex: 1; padding: 15px; font-size: 16px; font-weight: bold;">
                ì·¨ì†Œ
            </button>
            <button type="submit" class="btn btn-submit" id="submitBtn" style="flex: 1; padding: 15px; font-size: 16px; font-weight: bold;">
                ë“±ë¡í•˜ê¸°
            </button>
        </div>

    </form>


</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // ë¹„ë°€ë²ˆí˜¸ ê°•ë„ ì²´í¬
    function checkPasswordStrength() {
        const password = document.getElementById('password').value;
        const strengthDiv = document.getElementById('passwordStrength');

        if (password.length === 0) {
            strengthDiv.innerHTML = '';
            return;
        }

        let strength = 0;
        let feedback = [];

        if (password.length >= 8) strength++; else feedback.push('8ì ì´ìƒ');
        if (/[a-z]/.test(password)) strength++; else feedback.push('ì†Œë¬¸ì');
        if (/[A-Z]/.test(password)) strength++; else feedback.push('ëŒ€ë¬¸ì');
        if (/[0-9]/.test(password)) strength++; else feedback.push('ìˆ«ì');
        if (/[^A-Za-z0-9]/.test(password)) strength++; else feedback.push('íŠ¹ìˆ˜ë¬¸ì');

        if (strength < 3) {
            strengthDiv.innerHTML = `<span class="strength-weak">ì•½í•¨ - í•„ìš”: ${feedback.join(', ')}</span>`;
        } else if (strength < 4) {
            strengthDiv.innerHTML = '<span class="strength-medium">ë³´í†µ - ì‚¬ìš© ê°€ëŠ¥</span>';
        } else {
            strengthDiv.innerHTML = '<span class="strength-strong">ê°•í•¨ - ë§¤ìš° ì•ˆì „</span>';
        }
    }

    // ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ í™•ì¸
    function checkPasswordMatch() {
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        const matchDiv = document.getElementById('passwordMatch');

        if (confirmPassword.length === 0) {
            matchDiv.innerHTML = '';
            return;
        }

        if (password === confirmPassword) {
            matchDiv.innerHTML = '<span class="strength-strong">âœ“ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤</span>';
            document.getElementById('confirmPassword').classList.remove('is-invalid');
            document.getElementById('confirmPassword').classList.add('is-valid');
        } else {
            matchDiv.innerHTML = '<span class="strength-weak">âœ— ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤</span>';
            document.getElementById('confirmPassword').classList.remove('is-valid');
            document.getElementById('confirmPassword').classList.add('is-invalid');
        }
    }

    // ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸ (ê°€ì§œ API í˜¸ì¶œ)
    function checkEmailAvailability() {
        const email = document.getElementById('email').value;
        const availabilityDiv = document.getElementById('emailAvailability');

        if (!email || !email.includes('@')) {
            availabilityDiv.innerHTML = '';
            return;
        }

        // ì‹¤ì œë¡œëŠ” ì„œë²„ API í˜¸ì¶œ
        setTimeout(() => {
            if (email === 'admin@test.com') {
                availabilityDiv.innerHTML = '<span class="text-danger">âœ— ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤</span>';
                document.getElementById('email').classList.add('is-invalid');
            } else {
                availabilityDiv.innerHTML = '<span class="text-success">âœ“ ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë©”ì¼ì…ë‹ˆë‹¤</span>';
                document.getElementById('email').classList.remove('is-invalid');
                document.getElementById('email').classList.add('is-valid');
            }
        }, 500);
    }

    // ê¶Œí•œ ì„¤ëª… ì—…ë°ì´íŠ¸
    function updateRoleDescription() {
        const rolePermissions = document.getElementById('rolePermissions');
        const permissionList = document.getElementById('permissionList');
        const superAdmin = document.getElementById('roleSuperAdmin').checked;
        const admin = document.getElementById('roleAdmin').checked;

        if (superAdmin) {
            permissionList.innerHTML = `
                    <li>âœ… ëª¨ë“  ê´€ë¦¬ì ê³„ì • ê´€ë¦¬</li>
                    <li>âœ… ì¹´í˜ ìŠ¹ì¸/ê±°ë¶€/ì‚­ì œ</li>
                    <li>âœ… ì‚¬ìš©ì ê³„ì • ê´€ë¦¬</li>
                    <li>âœ… ì‹œìŠ¤í…œ ì„¤ì • ë³€ê²½</li>
                    <li>âœ… ëª¨ë“  ë°ì´í„° ì ‘ê·¼</li>
                `;
            rolePermissions.style.display = 'block';
        } else if (admin) {
            permissionList.innerHTML = `
                    <li>âœ… ì¹´í˜ ì •ë³´ ì¡°íšŒ/ìˆ˜ì •</li>
                    <li>âœ… ì‚¬ìš©ì ê³„ì • ì¡°íšŒ</li>
                    <li>âœ… ê¸°ë³¸ì ì¸ ê´€ë¦¬ ê¸°ëŠ¥</li>
                    <li>âŒ ê´€ë¦¬ì ê³„ì • ê´€ë¦¬ ë¶ˆê°€</li>
                    <li>âŒ ì‹œìŠ¤í…œ ì„¤ì • ë³€ê²½ ë¶ˆê°€</li>
                `;
            rolePermissions.style.display = 'block';
        } else {
            rolePermissions.style.display = 'none';
        }
    }

    // ì·¨ì†Œ ë²„íŠ¼
    function goBack() {
        if (confirm('ì‘ì„± ì¤‘ì¸ ë‚´ìš©ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤. ì •ë§ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            window.location.href = '/admin/manager/list';
        }
    }

    // í¼ ì œì¶œ ì „ ìœ íš¨ì„± ê²€ì‚¬
    document.querySelector('form').addEventListener('submit', function(e) {
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        if (password !== confirmPassword) {
            e.preventDefault();
            alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            document.getElementById('confirmPassword').focus();
            return false;
        }

        // ì œì¶œ ë²„íŠ¼ ë¹„í™œì„±í™” (ì¤‘ë³µ ì œì¶œ ë°©ì§€)
        const submitBtn = document.getElementById('submitBtn');
        submitBtn.disabled = true;
        submitBtn.innerHTML = 'ë“±ë¡ ì¤‘... <span class="spinner-border spinner-border-sm ms-2"></span>';
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
        console.log('ê´€ë¦¬ì ë“±ë¡ í˜ì´ì§€ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
    });
</script>
</body>
</html>