<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Together - 소모임 서비스</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <!-- 캐시 무효화: System 금지, #dates 사용 -->
    <link rel="stylesheet" th:href="@{/css/mainPage.css(v=${#dates.createNow().time})}">

    <style>
        .hero-content {
            margin-top: 100px;
            height: 350px;
        }
        .slider-container {
            padding: 0;
        }
        main section.container {
            margin-top: 3rem;
            margin-bottom: 3rem;
        }
    </style>
</head>
<body>

<div th:replace="~{/layout/header :: header}"></div>

<main>
    <!-- HERO -->
    <section class="hero-section">
        <div class="container hero-content">
            <div class="text-column">
                <h1>
                    같이 놀 사람? <span class="hero-accent">여기 모여라!</span>
                </h1>
                <p>
                    누구나 쉽게, 어디서든 가볍게! 같은 관심사만 있으면 지역은 상관없어요!<br>
                    산책, 독서, 보드게임 등 마음 맞는 사람들과 자연스럽게<br>
                    어울릴 수 있는 공간입니다!
                </p>
            </div>
            <div class="image-column">
                <img th:src="@{/images/mainPage.jpg}" alt="모임 일러스트" class="banner-image">
            </div>
        </div>
    </section>

    <!-- 카테고리: 왼쪽 큰 카드 + 오른쪽 3×2, 7개 단위 반복 (ALL 제거) -->
    <section class="container" id="category-explore">
        <h2 class="section-title section-title--left">
            <span class="accent">카테고리별</span> <span class="muted">탐색</span>
        </h2>

        <th:block th:with="size=${#lists.size(categories)}">
            <th:block th:each="g : ${#numbers.sequence(0, size - 1, 7)}">
                <div class="category-seven-grid">
                    <!-- 왼쪽 큰 카드 -->
                    <a class="cat-card cat-card--feature"
                       th:if="${g < size}"
                       th:href="@{/categories(category=${categories[g].name()})}">
                        <img th:if="${categories[g].imageUrl != null}" th:src="${categories[g].imageUrl}" th:alt="|${categories[g].koreanName}|">
                        <img th:if="${categories[g].imageUrl == null}" th:src="@{/images/category-default.png}" th:alt="|${categories[g].koreanName}|">
                        <div class="cat-label" th:text="${categories[g].koreanName}">카테고리</div>
                    </a>

                    <!-- 오른쪽 3×2 -->
                    <th:block th:each="k : ${#numbers.sequence(1,6)}">
                        <a th:if="${g + k < size}"
                           class="cat-card"
                           th:href="@{/categories(category=${categories[g+k].name()})}">
                            <img th:if="${categories[g+k].imageUrl != null}" th:src="${categories[g+k].imageUrl}" th:alt="|${categories[g+k].koreanName}|">
                            <img th:if="${categories[g+k].imageUrl == null}" th:src="@{/images/category-default.png}" th:alt="|${categories[g+k].koreanName}|">
                            <div class="cat-label" th:text="${categories[g+k].koreanName}">카테고리</div>
                        </a>
                    </th:block>
                </div>
            </th:block>
        </th:block>
    </section>

    <!-- 추천 카페 (왼쪽 정렬, '추천'은 기본 초록, '카페'는 탐색과 동일한 연회색) -->
    <section class="container slider-section">
        <h2 class="section-title section-title--left section-title--split">
            <span class="title-base">추천</span> <span class="title-accent">카페</span>
        </h2>

        <div class="slider-container">
            <button class="slider-button prev"><i class="fas fa-chevron-left"></i></button>
            <div class="slider-wrapper" id="recom-slider">
                <th:block th:if="${recomCafes != null}" th:remove="tag">
                    <div class="slider-card" th:each="cafe : ${recomCafes}">
                        <a th:href="@{/cafe/{cafeId}(cafeId=${cafe.id})}" class="card-link">
                            <div class="card h-100">
                                <img th:if="${cafe.cafeThumbnail != null}" th:src="${cafe.cafeThumbnail}"
                                     th:alt="|${cafe.name} 카페 이미지|" class="card-img-top">
                                <img th:if="${cafe.cafeThumbnail == null}" th:src="@{/images/default-cafe.png}"
                                     th:alt="|${cafe.name} 카페 이미지|" class="card-img-top">
                                <div class="card-body">
                                    <h5 class="card-title" th:text="${cafe.name}">카페 이름</h5>
                                    <p class="card-text text-muted small mb-0" th:text="${cafe.description}">카페 설명</p>
                                </div>
                            </div>
                        </a>
                    </div>
                </th:block>
                <div th:if="${recomCafes == null or #lists.isEmpty(recomCafes)}" class="slider-card empty-card">
                    <p class="text-center text-muted">추천 카페가 아직 없습니다.</p>
                </div>
            </div>
            <button class="slider-button next"><i class="fas fa-chevron-right"></i></button>
        </div>
    </section>

    <!-- 인기 중고거래 (왼쪽 정렬, 간격 축소, '중고거래'는 탐색과 동일 연회색) -->
    <section class="container slider-section trade-section">
        <h2 class="section-title section-title--left section-title--split">
            <span class="title-base">인기</span> <span class="title-accent">중고거래</span>
        </h2>

        <div class="slider-container">
            <button class="slider-button prev trade-prev"><i class="fas fa-chevron-left"></i></button>
            <div class="slider-wrapper" id="trade-slider">
                <th:block th:if="${recomTrades != null}" th:remove="tag">
                    <div class="slider-card" th:each="trade : ${recomTrades}">
                        <a th:href="@{/trade/read/{id}(id=${trade.id})}" class="card-link">
                            <div class="card h-100">
                                <img th:if="${trade.thumbnail != null}" th:src="${trade.thumbnail}"
                                     th:alt="|${trade.title} 상품 이미지|" class="card-img-top">
                                <img th:if="${trade.thumbnail == null}" th:src="@{/images/default-trade.png}"
                                     th:alt="|${trade.title} 상품 이미지|" class="card-img-top">
                                <div class="card-body">
                                    <h5 class="card-title" th:text="${trade.title}">거래 제목</h5>
                                    <p class="card-text text-success small mb-0 fw-bold">
                                        <span th:text="${#numbers.formatDecimal(trade.price, 0, 'COMMA', 0, 'POINT')}">0</span>원
                                    </p>
                                </div>
                            </div>
                        </a>
                    </div>
                </th:block>
                <div th:if="${recomTrades == null or #lists.isEmpty(recomTrades)}" class="slider-card empty-card">
                    <p class="text-center text-muted" style="min-width: 100%;">인기 중고거래 상품이 아직 없습니다.</p>
                </div>
            </div>
            <button class="slider-button next trade-next"><i class="fas fa-chevron-right"></i></button>
        </div>
    </section>
</main>

<div th:replace="~{/layout/footer :: footer}"></div>

<script th:src="@{/js/mainPage.js}"></script>

</body>
</html>
