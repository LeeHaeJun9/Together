<!-- templates/layout/header.html -->
<header th:fragment="header"
        class="container px-4 px-lg-5"
        xmlns:th="http://www.thymeleaf.org"
        xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- 프로젝트 헤더 전용 CSS(있다면 유지) -->
    <link rel="stylesheet" th:href="@{/css/header.css}">

    <style>
        /* 상단 바: 밑줄 제거 */
        .header-top{
            min-height:64px;
            display:flex; align-items:center; justify-content:space-between;
            background:#fff;
        }

        .right-area{ display:flex; align-items:center; gap:16px; }

        /* 아이콘 버튼 (마이페이지 왼쪽에 나열) */
        .quick-icons{ display:flex; align-items:center; gap:12px; }
        .quick-btn{
            position:relative; display:inline-flex; align-items:center; justify-content:center;
            width:40px; height:40px; border-radius:12px; color:#6c757d;
            text-decoration:none; background:#fff; transition:.15s;
        }
        .quick-btn:hover{ color:#0d6efd; border-color:#d7e6ff; background:#f5f9ff; }
        .quick-btn svg{ width:22px; height:22px; }
        .quick-badge{
            position:absolute; top:-6px; right:-6px; min-width:20px; height:20px; padding:0 6px;
            font-size:.78rem; line-height:20px; text-align:center; border-radius:999px;
            background:#e9ecef; color:#495057; border:1px solid #fff;
        }
        .quick-btn.fav:hover{ color:#e03131; border-color:#ffe3e3; background:#fff5f5; }

        /* 말풍선 툴팁(검정 버블) */
        :root .tooltip.bubble .tooltip-inner{
            position:relative; background:#111 !important; color:#fff !important;
            padding:6px 10px !important; font-size:.875rem !important; line-height:1.2 !important;
            border-radius:8px !important; box-shadow:0 4px 12px rgba(0,0,0,.2) !important; white-space:nowrap;
        }
        :root .tooltip.bubble .tooltip-arrow{ display:none !important; }
        :root .tooltip.bubble.bs-tooltip-bottom .tooltip-inner::after{
            content:""; position:absolute; left:50%; transform:translateX(-50%); top:-8px;
            width:0; height:0; border-style:solid; border-width:0 8px 8px 8px; border-color:transparent transparent #111 transparent;
        }
    </style>

    <div class="header-top">
        <!-- 로고 -->
        <a th:href="@{/mainPage}" class="logo-section d-inline-flex align-items-center gap-2 text-decoration-none">
            <img th:src="@{/images/moyeora-logo.png}" alt="Together 로고" style="height:34px"/>
            <span class="fw-semibold text-dark">모여라</span>
        </a>

        <!-- 오른쪽: 아이콘(왼쪽) + 내비게이션(오른쪽) -->
        <div class="right-area">

            <!-- 여기 아이콘이 '마이페이지' 왼쪽에 위치 -->
            <div class="quick-icons">
                <!-- 카페 목록 -->
                <a class="quick-btn"
                   th:href="@{/cafe/list}"
                   aria-label="카페목록"
                   data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-custom-class="bubble"
                   title="카페목록">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cup-hot" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M.5 6a.5.5 0 0 0-.488.608l1.652 7.434A2.5 2.5 0 0 0 4.104 16h5.792a2.5 2.5 0 0 0 2.44-1.958l.131-.59a3 3 0 0 0 1.3-5.854l.221-.99A.5.5 0 0 0 13.5 6zM13 12.5a2 2 0 0 1-.316-.025l.867-3.898A2.001 2.001 0 0 1 13 12.5M2.64 13.825 1.123 7h11.754l-1.517 6.825A1.5 1.5 0 0 1 9.896 15H4.104a1.5 1.5 0 0 1-1.464-1.175"/>
                        <path d="m4.4.8-.003.004-.014.019a4 4 0 0 0-.204.31 2 2 0 0 0-.141.267c-.026.06-.034.092-.037.103v.004a.6.6 0 0 0 .091.248c.075.133.178.272.308.445l.01.012c.118.158.26.347.37.543.112.2.22.455.22.745 0 .188-.065.368-.119.494a3 3 0 0 1-.202.388 5 5 0 0 1-.253.382l-.018.025-.005.008-.002.002A.5.5 0 0 1 3.6 4.2l.003-.004.014-.019a4 4 0 0 0 .204-.31 2 2 0 0 0 .141-.267c.026-.06.034-.092.037-.103a.6.6 0 0 0-.09-.252A4 4 0 0 0 3.6 2.8l-.01-.012a5 5 0 0 1-.37-.543A1.53 1.53 0 0 1 3 1.5c0-.188.065-.368.119-.494.059-.138.134-.274.202-.388a6 6 0 0 1 .253-.382l.025-.035A.5.5 0 0 1 4.4.8m3 0-.003.004-.014.019a4 4 0 0 0-.204.31 2 2 0 0 0-.141.267c-.026.06-.034.092-.037.103v.004a.6.6 0 0 0 .091.248c.075.133.178.272.308.445l.01.012c.118.158.26.347.37.543.112.2.22.455.22.745 0 .188-.065.368-.119.494a3 3 0 0 1-.202.388 5 5 0 0 1-.253.382l-.018.025-.005.008-.002.002A.5.5 0 0 1 6.6 4.2l.003-.004.014-.019a4 4 0 0 0 .204-.31 2 2 0 0 0 .141-.267c.026-.06.034-.092.037-.103a.6.6 0 0 0-.09-.252A4 4 0 0 0 6.6 2.8l-.01-.012a5 5 0 0 1-.37-.543A1.53 1.53 0 0 1 6 1.5c0-.188.065-.368.119-.494.059-.138.134-.274.202-.388a6 6 0 0 1 .253-.382l.025-.035A.5.5 0 0 1 7.4.8m3 0-.003.004-.014.019a4 4 0 0 0-.204.31 2 2 0 0 0-.141.267c-.026.06-.034.092-.037.103v.004a.6.6 0 0 0 .091.248c.075.133.178.272.308.445l.01.012c.118.158.26.347.37.543.112.2.22.455.22.745 0 .188-.065.368-.119.494a3 3 0 0 1-.202.388 5 5 0 0 1-.252.382l-.019.025-.005.008-.002.002A.5.5 0 0 1 9.6 4.2l.003-.004.014-.019a4 4 0 0 0 .204-.31 2 2 0 0 0 .141-.267c.026-.06.034-.092.037-.103a.6.6 0 0 0-.09-.252A4 4 0 0 0 9.6 2.8l-.01-.012a5 5 0 0 1-.37-.543A1.53 1.53 0 0 1 9 1.5c0-.188.065-.368.119-.494.059-.138.134-.274.202-.388a6 6 0 0 1 .253-.382l.025-.035A.5.5 0 0 1 10.4.8"/>
                    </svg>
                </a>

                <!-- 중고거래 -->
                <a class="quick-btn"
                   th:href="@{/trade/list}"
                   aria-label="중고거래"
                   data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-custom-class="bubble"
                   title="중고거래">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-bag" viewBox="0 0 16 16" aria-hidden="true">
                        <path d="M8 1a2.5 2.5 0 0 1 2.5 2.5V4h-5v-.5A2.5 2.5 0 0 1 8 1m3.5 3v-.5a3.5 3.5 0 1 0-7 0V4H1v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4zM2 5h12v9a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1z"/>
                    </svg>
                    <span class="quick-badge" th:if="${tradeCount != null}" th:text="${tradeCount}">0</span>
                </a>

                <!-- 찜목록 -->
                <a class="quick-btn fav"
                   th:href="@{/member/favorites}"
                   aria-label="찜목록"
                   data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-custom-class="bubble"
                   title="찜목록">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cart" viewBox="0 0 16 16">
                        <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5M3.102 4l1.313 7h8.17l1.313-7zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4m7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4m-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2m7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/>
                    </svg>
                </a>
            </div>

            <!-- 내비게이션(아이콘 오른쪽) -->
            <nav>
                <ul class="nav-links list-unstyled d-flex gap-3 mb-0" sec:authorize="!isAuthenticated()">
                    <li class="nav-link"><a th:href="@{/member/login}">로그인</a></li>
                    <li class="nav-link"><a th:href="@{/member/register}">회원가입</a></li>
                </ul>

                <ul class="nav-links list-unstyled d-flex gap-3 mb-0" sec:authorize="isAuthenticated() && !hasRole('ADMIN')">
                    <li class="nav-link"><a th:href="@{/member/mypage}">마이페이지</a></li>
                    <li class="nav-link"><a th:href="@{/logout}">로그아웃</a></li>
                </ul>

                <ul class="nav-links list-unstyled d-flex gap-3 mb-0" sec:authorize="hasRole('ADMIN')">
                    <li class="nav-link"><a th:href="@{/member/mypage}">마이페이지</a></li>
                    <li class="nav-link"><a th:href="@{/logout}">로그아웃</a></li>
                    <li class="nav-link"><a th:href="@{/manager}">관리자페이지</a></li>
                    <li class="nav-link"><a th:href="@{/cafe/admin/applications}">카페 가입 승인</a></li>
                </ul>
            </nav>
        </div>
    </div>

    <!-- Bootstrap JS & 툴팁 초기화 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        (function () {
            if (!(window.bootstrap && bootstrap.Tooltip)) return;
            document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(function (el) {
                const inst = bootstrap.Tooltip.getInstance(el);
                if (inst) inst.dispose();
                new bootstrap.Tooltip(el, { container: 'body' });
            });
        })();
    </script>
</header>
