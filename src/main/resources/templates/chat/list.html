<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>내 채팅</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        :root{ --line:#e9edf3; --muted:#6c757d; }
        .chatlist-wrap{ max-width: 960px; margin: 0 auto; }
        .room-card{ border:1px solid var(--line); border-radius:14px; padding:12px; background:#fff; }
        .thumb{ width: 92px; height: 92px; border-radius:12px; object-fit:cover; border:1px solid var(--line); background:#f8f9fa; }
        .title{ font-weight:600; margin-bottom:2px; }
        .preview{ color:var(--muted); font-size:.9rem; }
        .right small{ color:var(--muted); }
    </style>
</head>
<body>
<div th:replace="~{/layout/header :: header}"></div>

<div class="container py-3 chatlist-wrap">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="mb-0">내 채팅</h4>
        <div class="d-flex gap-2">
            <a class="btn btn-sm btn-outline-secondary" th:href="@{/trade/list}">상품목록</a>
        </div>
    </div>

    <div class="vstack gap-2" th:if="${#lists.isEmpty(items)}">
        <div class="alert alert-light border">채팅이 없습니다.</div>
    </div>

    <div class="vstack gap-2" th:if="${!#lists.isEmpty(items)}">
        <a class="room-card d-flex align-items-center gap-3 text-decoration-none text-reset"
           th:each="it : ${items}"
           th:href="@{'/chat/room/' + ${it.roomId}}">
            <img class="thumb"
                 th:with="noImg=@{/images/no-image.png}"
                 th:src="${it.thumbnail != null && !#strings.isEmpty(it.thumbnail) ? it.thumbnail : noImg}"
                 alt="thumb"
                 onerror="this.onerror=null;this.src='/images/no-image.png'">

            <div class="flex-grow-1">
                <div class="title text-truncate" th:text="${it.tradeTitle}">제목</div>
                <div class="d-flex align-items-center gap-2 flex-wrap">
                    <span class="badge text-bg-secondary" th:text="${it.categoryLabel}">카테고리</span>
                    <span class="badge" th:classappend="${it.statusClass}" th:text="${it.statusLabel}">상태</span>
                    <span class="fw-semibold" th:text="${it.priceText}">0원</span>
                </div>
                <div class="preview mt-1">
                    <strong th:text="${it.counterpartName}">상대</strong>:
                    <span th:text="${it.lastContent}">(대화 없음)</span>
                </div>
            </div>

            <div class="right text-end">
                <small th:text="${#temporals.format(it.lastTime, 'yyyy.MM.dd HH:mm')}">날짜</small>
            </div>
        </a>
    </div>
</div>

<div th:replace="~{/layout/footer :: footer}"></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
